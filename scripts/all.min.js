(function(a){function b(){}function c(a){if(!a)return 0;a=a.split(".");return 1E4*parseInt(a[0])+100*parseInt(a[1])+parseInt(a[2])}function d(a){for(var a=a.replace(/-/g,"_"),a=a.split("."),c=f,h=0;h<a.length;h++)c[a[h]]===void 0&&(c[a[h]]=new b),c=c[a[h]];return c}var f=a.namespace;if(f){if(c("3.0.1")<=c(f.VERSION))return;b=f.constructor}else a.namespace=f=new b;f.VERSION="3.0.1";a=b.prototype;a.module=function(a,b){var c=d(a);b&&b(c,d);return c};a.extend=function(a){for(var b in a)a.hasOwnProperty(b)&&
(this[b]=a[b])}})(this);
<<<<<<< HEAD
namespace.module("org.startpad.types",function(a){function b(a,b){return c(a)==b}function c(a){if(a===void 0)return"undefined";if(a===null)return"null";var b=Object.prototype.toString.call(a).match(/\[object (.*)\]/)[1].toLowerCase();d.indexOf(b)==-1&&(b=typeof a);return b}a.extend({VERSION:"0.1.0",isArguments:function(a){return b(a,"arguments")},isArray:function(a){return b(a,"array")},copyArray:function(a){return Array.prototype.slice.call(a)},isType:b,typeOf:c,extend:function(a){var b,c,d,e;a===
void 0&&(a={});for(b=1;b<arguments.length;b++){d=arguments[b];for(e in d)d.hasOwnProperty(e)&&(a[e]=d[e]);if(f)for(c=0;c<g.length;c++)e=g[c],d.hasOwnProperty(e)&&(a[e]=d[e])}return a},project:function(a,b){for(var c={},d=0;d<b.length;d++){var e=b[d];a&&a.hasOwnProperty(e)&&(c[e]=a[e])}return c},getFunctionName:function(a){if(typeof a=="function")return a=a.toString().match(/function\s*(\S+)\s*\(/),!a?"":a[1]}});var d="number,string,boolean,array,function,date,regexp,arguments,undefined,null".split(","),
f=!{toString:!0}.propertyIsEnumerable("toString"),g=["toString","toLocaleString","valueOf","constructor","isPrototypeOf"]});
namespace.module("org.startpad.funcs",function(a,b){function c(a){if(!a)return 0;a=a.split(".");return 1E4*parseInt(a[0])+100*parseInt(a[1])+parseInt(a[2])}function d(a,b,d,e){if(!(a._patches&&c(a._patches[b])>=c(d)))a._patches=a._patches||{},a._patches[b]=d,f(a,e)}function f(a,b){e.extend(a.prototype,b)}function g(a,b){function c(a,b){for(var d=e.copyArray(a),b=e.copyArray(b),j=0;j<d.length;j++)d[j]===void 0&&(d[j]=b.shift());return d.concat(b)}var d;d=arguments.length==3&&e.isArguments(arguments[2])?
Array.prototype.slice.call(arguments[2],self1):Array.prototype.slice.call(arguments,2);return function(){return a.apply(b||this,c(d,arguments))}}function k(a,b){function c(){return b.call(this,a,arguments,c)}b.call(a,void 0,arguments,c);return c}function h(a){function b(){}b.prototype=a;return new b}function l(b,c,d){b.prototype=a.create(c.prototype);b.prototype.constructor=b;f(b,d)}function i(b,c){for(var d=b.pop().prototype,g;b.length>0;){g=b.pop();var h=e.getFunctionName(g),i=a.create(d);e.extend(i,
g.prototype);i.constructor=g;i[h+"_super"]=d;d=i}g.prototype=d;f(g,c)}var e=b("org.startpad.types");a.extend({VERSION:"0.3.0",methods:f,bind:g,decorate:k,create:Object.create||h,subclass:l,mro:i,numericVersion:c,monkeyPatch:d,patch:function(){d(Function,"org.startpad.funcs",a.VERSION,{methods:function(a){f(this,a)},curry:function(){var a=[this,void 0].concat(e.copyArray(arguments));return g.apply(void 0,a)},curryThis:function(a){var b=e.copyArray(arguments);b.unshift(this);return g.apply(void 0,b)},
decorate:function(a){return k(this,a)},subclass:function(a,b){l(this,a,b)},mro:function(a,b){a.unshift(this);i(a,b)}});return a}})});
namespace.module("org.startpad.string",function(a,b){function c(a,b,c){c=c||f;if(a==void 0)return"undefined";a=a.toString();return a=a.replace(c,function(a,c){for(var d=b,f=c.split("."),g=0;g<f.length;g++){var c=f[g],h=parseInt(c),d=isNaN(h)?d[c]:d[h];if(d==void 0)return""}return d})}var d=b("org.startpad.funcs");a.extend({VERSION:"0.1.2",patch:function(){d.monkeyPatch(String,"org.startpad.string",a.VERSION,{format:function(){return arguments.length==1&&typeof arguments[0]=="object"?c(this,arguments[0]):
c(this,arguments)}});return a},format:c});var f=/\{\s*([^} ]+)\s*\}/g});var clientLib=require("com.pageforest.client"),dom=require("org.startpad.dom"),format=require("org.startpad.format");exports.extend({onReady:onReady,getDoc:getDoc,setDoc:setDoc,onSaveSuccess:onSaveSuccess,handleLocationHash:handleLocationHash,setCursorPos:setCursorPos,getDocid:getDocid,setDocid:setDocid});
var startTime=Math.floor((new Date).getTime()/1E3),client,doc,blob,latestText="",renderedText="",syncTime=5,editVisible=!1,editorInitialized=!1,editTimer,EDIT_BUFFER=1E3,currentScale,currentShift=0,slideBoundries=[],curBoundriesText="",onReadyToggleEditor,BASE_HEIGHT=140,BUTTON_HEIGHT=38,IDEAL_WIDTH=1300,COMPRESSED_WIDTH=900,HEIGHT=700,OUTPUT_WIDTH=0.9,OUTPUT_WIDTH_EDIT=0.4317,stockCode={};function getDocid(){return handleLocationHash().doc}function setDocid(a){handleLocationHash({doc:a})}
function handleLocationHash(a){var b=document.location.hash.replace(/#/,""),c,d;if(b.length>0&&b.search("doc=")==-1&&b.search("page=")==-1)document.location=location.href.replace("#"+b,"#doc="+b);b.search("doc=")>-1&&(c=b.replace("doc=",""),c.search("&")>-1&&(c=c.split("&")[0]));b.search("page=")>-1&&(d=b.split("page="),d=d[d.length-1]);if(a){if(a.doc)c=a.doc;if(a.page)d=a.page;b="#";c&&(b+="doc="+c);d&&(c&&(b+="&"),b+="page="+d);location.replace(b)}return{doc:c,page:d}}
function onEditChange(a){if(a)switch(a.keyCode){case 39:case 37:case 40:case 38:case 34:case 33:return}latestText=doc.editor.value;editTimer==void 0&&(editTimer=setTimeout(render,EDIT_BUFFER));client.setDirty()}
function render(){latestText!=curBoundriesText&&getSlideBoundries();editTimer=void 0;renderedText!=latestText&&(editTimer=setTimeout(render,EDIT_BUFFER),$(doc.output).html("<section class='slides'>"+latestText+"</section>"),renderedText=latestText,refresh(),tooFarInFuture(),onResize(),setSlidePosFromCursor())}function tooFarInFuture(){curSlide<slideEls.length||(slideEls.length==0&&adjustSlidePos(0),adjustSlidePos(slideEls.length-1))}
function adjustSlidePos(a){a-=curSlide;var b;if(a!==0)if(a>0)for(b=0;b<a;b++)for(var c=curSlide;curSlide==c&&curSlide<slideEls.length-1;)nextSlide("automated");else for(b=0;b<-a;b++)prevSlide("automated")}function toggleEditor(){(editVisible=!editVisible)?($(doc.page).addClass("edit"),editorInitialized||(editorInitialized=!0,$(doc.editor).bind("keyup",onEditChange))):$(doc.page).removeClass("edit");onResize();$(doc.edit).val(editVisible?"Full":"Edit")}
function insertStockCode(){var a,b,c;if(a=trimCode(stockCode[$(doc.select).val()]))b=$(doc.editor).val(),c=b.slice(doc.editor.selectionEnd),c.indexOf("<article")==-1?a=b+"\n"+a:(c=doc.editor.selectionEnd+c.indexOf("<article"),a=b.slice(0,c)+a+"\n"+b.slice(c)),$(doc.editor).val(a),onEditChange()}
function trimCode(a){var a=a.replace(/^\n+|\s+$/g,""),b=/^\s+/.exec(a);if(b){for(var b=RegExp("^\\s{"+b[0].length+"}"),a=a.split("\n"),c=0;c<a.length;c++)a[c]=a[c].replace(b,"");a=a.join("\n")}return a+"\n"}
function onReady(){handleAppCache();doc=dom.bindIDs();client=new clientLib.Client(exports);client.saveInterval=0;client.addAppBar();$(doc.edit).click(toggleEditor);$(doc.insert).click(insertStockCode);$(doc.editor).keydown(tabToSpace);$(doc.editor).bind("keydown click",setSlidePosFromCursor);$(window).bind("resize",onResize);$(doc.fullscreen).bind("click",function(a){a.preventDefault();alert("You have to save a document to view it fullscreen")});$(doc.next).click(nextSlide);$(doc.prev).click(prevSlide);
$(doc.output).html("<section class='slides'><article></article></section>");handleDomLoaded();handleLocationHash().doc||$.ajax({url:"slides.html",error:function(){console.log("ajax load error")},success:function(a){setDoc({title:"Editable HTML5 Slides",blob:{version:1.1,slides:a}})}});for(var a=$("script[type=slide-template]"),b,c=0;c<a.length;c++)b=a[c],stockCode[b.title]=$(b).text();onReadyToggleEditor=!0}
function getSlideBoundries(){var a,b,c=0,d=$(doc.editor).val();b=slideBoundries=[0];for(a=d.indexOf("</article>")+10;a>9;)c+=a,b[b.length]=c,d=d.slice(a),a=d.indexOf("</article>")+10;curBoundriesText=latestText}
function setSlidePosFromCursor(){if(!(doc.editor.selectionEnd>slideBoundries[curSlide]&&doc.editor.selectionEnd<slideBoundries[curSlide+1])){for(var a=1;a<slideBoundries.length;a++)if(slideBoundries[a]>=doc.editor.selectionEnd){adjustSlidePos(a-1);return}adjustSlidePos(slideEls.length-1)}}
function setCursorPos(){$(doc.phantomPre).text($(doc.editor).val().slice(0,slideBoundries[curSlide]));var a=doc.phantom.offsetHeight;a<100&&(a=0);doc.editor.selectionStart=slideBoundries[curSlide];doc.editor.selectionEnd=slideBoundries[curSlide];$(doc.editor).scrollTop(a);$(doc.editor).blur()}function tabToSpace(a){if(a.keyCode==9){var b=this.selectionStart;a.preventDefault();a=$(this).val();a=a.slice(0,b)+"  "+a.slice(b);$(this).val(a);this.selectionEnd=this.selectionStart=b+2}}
function positionNav(){if(editVisible){var a=doc.output.offsetHeight*currentScale+window.scrollY;$(doc.nav).css("top",a+"px")}else $(doc.nav).css("top",doc.outputBlock.offsetHeight-35+"px")}
function onResize(){var a=editVisible?COMPRESSED_WIDTH:IDEAL_WIDTH,b,c;editVisible?(b=window.innerHeight-BASE_HEIGHT-BUTTON_HEIGHT,c=window.innerWidth*OUTPUT_WIDTH_EDIT,b/HEIGHT>c/COMPRESSED_WIDTH?(currentScale=doc.outputBlock.offsetWidth/a,currentShift>0&&(currentShift=0)):(currentScale=b/HEIGHT,currentShift=(c-COMPRESSED_WIDTH*currentScale)/2),$(doc.editor).css("height",window.innerHeight-BASE_HEIGHT),$(doc.outputBlock).css("height",window.innerHeight-BASE_HEIGHT)):(b=window.innerHeight-BASE_HEIGHT-
BUTTON_HEIGHT,c=window.innerWidth*OUTPUT_WIDTH,b/HEIGHT>c/IDEAL_WIDTH?(currentScale=c/IDEAL_WIDTH,currentShift=0):(currentScale=b/HEIGHT,currentShift=(c-IDEAL_WIDTH*currentScale)/2),$(doc.outputBlock).css("height",currentScale*HEIGHT+BUTTON_HEIGHT+"px"));$(doc.phantom).css("width",doc.editor.scrollWidth+"px");setCrossTransform(doc.output,"transform");positionNav()}
function setCrossTransform(a,b){var c="translate("+currentShift+"px, 0px) scale("+currentScale+")";$(a).css("-webkit-"+b,c);$(a).css("-moz-"+b,c);$(a).css("-o-"+b,c);$(a).css("-ms-"+b,c);$(a).css(b,c)}function updateMeta(a){document.title=a.title;$("#title").text(a.title);$(doc.fullscreen).unbind();$(doc.fullscreen).attr("href",location.href.replace(/&page=[0-9]+/,"").replace("#doc=","docs/")+"/slides")}
function onSaveSuccess(){updateMeta(client.meta);client.storage.putBlob(client.docid,"slides","<!DOCTYPE html>\n<\!--\nGoogle HTML5 slide template  Authors: Luke Mahe (code)\nMarcin Wichary (code and design)\nDominic Mazzoni (browser compatibility)\nCharles Chen (ChromeVox support)\nURL: http://code.google.com/p/html5slides/\n--\>\n<html>\n  <head>\n  <title>Presentation</title>\n    <meta charset='utf-8'>\n    <script src='http://html5slides.googlecode.com/svn/trunk/slides.js'><\/script>\n</head><body style='display: none'>    <section class='slides'>"+
renderedText+"</section></body></html>")}
function setDoc(a){console.log("setDoc()");a.blob.version===1?latestText=a.blob.markdown:a.blob.version===1.1?latestText=a.blob.slides:console.log("ERROR: unknown blob version number");renderedText=doc.editor.value=latestText;$(doc.output).css("display","none");$(doc.output).html("<section class='slides'>"+latestText+"</section>");refresh();getSlideBoundries();setCursorPos();onResize();$(doc.output).css("display","block");updateMeta(a);onReadyToggleEditor&&(toggleEditor(),onReadyToggleEditor=!1)}
=======
namespace.module("org.startpad.types",function(a){function b(a,b){return d(a)==b}function d(a){if(a===void 0)return"undefined";if(a===null)return"null";var b=Object.prototype.toString.call(a).match(/\[object (.*)\]/)[1].toLowerCase();e.indexOf(b)==-1&&(b=typeof a);return b}a.extend({VERSION:"0.1.0",isArguments:function(a){return b(a,"arguments")},isArray:function(a){return b(a,"array")},copyArray:function(a){return Array.prototype.slice.call(a)},isType:b,typeOf:d,extend:function(a){var b,d,e,f;a===
void 0&&(a={});for(b=1;b<arguments.length;b++){e=arguments[b];for(f in e)e.hasOwnProperty(f)&&(a[f]=e[f]);if(h)for(d=0;d<g.length;d++)f=g[d],e.hasOwnProperty(f)&&(a[f]=e[f])}return a},project:function(a,b){for(var d={},e=0;e<b.length;e++){var f=b[e];a&&a.hasOwnProperty(f)&&(d[f]=a[f])}return d},getFunctionName:function(a){if(typeof a=="function")return a=a.toString().match(/function\s*(\S+)\s*\(/),!a?"":a[1]}});var e="number,string,boolean,array,function,date,regexp,arguments,undefined,null".split(","),
h=!{toString:!0}.propertyIsEnumerable("toString"),g=["toString","toLocaleString","valueOf","constructor","isPrototypeOf"]});
namespace.module("org.startpad.funcs",function(a,b){function d(a){if(!a)return 0;a=a.split(".");return 1E4*parseInt(a[0])+100*parseInt(a[1])+parseInt(a[2])}function e(a,b,e,f){if(!(a._patches&&d(a._patches[b])>=d(e)))a._patches=a._patches||{},a._patches[b]=e,h(a,f)}function h(a,b){f.extend(a.prototype,b)}function g(a,b){function d(a,b){for(var e=f.copyArray(a),b=f.copyArray(b),o=0;o<e.length;o++)e[o]===void 0&&(e[o]=b.shift());return e.concat(b)}var e;e=arguments.length==3&&f.isArguments(arguments[2])?
Array.prototype.slice.call(arguments[2],self1):Array.prototype.slice.call(arguments,2);return function(){return a.apply(b||this,d(e,arguments))}}function m(a,b){function d(){return b.call(this,a,arguments,d)}b.call(a,void 0,arguments,d);return d}function j(a){function b(){}b.prototype=a;return new b}function n(b,d,e){b.prototype=a.create(d.prototype);b.prototype.constructor=b;h(b,e)}function q(b,d){for(var e=b.pop().prototype,g;b.length>0;){g=b.pop();var j=f.getFunctionName(g),k=a.create(e);f.extend(k,
g.prototype);k.constructor=g;k[j+"_super"]=e;e=k}g.prototype=e;h(g,d)}var f=b("org.startpad.types");a.extend({VERSION:"0.3.0",methods:h,bind:g,decorate:m,create:Object.create||j,subclass:n,mro:q,numericVersion:d,monkeyPatch:e,patch:function(){e(Function,"org.startpad.funcs",a.VERSION,{methods:function(a){h(this,a)},curry:function(){var a=[this,void 0].concat(f.copyArray(arguments));return g.apply(void 0,a)},curryThis:function(a){var b=f.copyArray(arguments);b.unshift(this);return g.apply(void 0,b)},
decorate:function(a){return m(this,a)},subclass:function(a,b){n(this,a,b)},mro:function(a,b){a.unshift(this);q(a,b)}});return a}})});
namespace.module("org.startpad.string",function(a,b){function d(a,b,d){d=d||h;if(a==void 0)return"undefined";a=a.toString();return a=a.replace(d,function(a,d){for(var e=b,h=d.split("."),g=0;g<h.length;g++){var d=h[g],j=parseInt(d),e=isNaN(j)?e[d]:e[j];if(e==void 0)return""}return e})}var e=b("org.startpad.funcs");a.extend({VERSION:"0.1.2",patch:function(){e.monkeyPatch(String,"org.startpad.string",a.VERSION,{format:function(){return arguments.length==1&&typeof arguments[0]=="object"?d(this,arguments[0]):
d(this,arguments)}});return a},format:d});var h=/\{\s*([^} ]+)\s*\}/g});var Showdown={converter:function(){var a,b,d,e=0;this.makeHtml=function(c){a=[];b=[];d=[];c=c.replace(/~/g,"~T");c=c.replace(/\$/g,"~D");c=c.replace(/\r\n/g,"\n");c=c.replace(/\r/g,"\n");c=w("\n\n"+c+"\n\n");c=c.replace(/^[ \t]+$/mg,"");c=g(c);c=h(c);c=j(c);c=x(c);c=c.replace(/~D/g,"$$");return c=c.replace(/~T/g,"~")};var h=function(c){return c=c.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,function(c,d,e,i,f){d=d.toLowerCase();a[d]=
y(e);if(i)return i+f;else f&&(b[d]=f.replace(/"/g,"&quot;"));return""})},g=function(c){c=c.replace(/\n/g,"\n\n");c=c.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,m);c=c.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,m);c=c.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,m);c=c.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,
m);c=c.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,m);return c=c.replace(/\n\n/g,"\n")},m=function(c,a){var b;b=a.replace(/\n\n/g,"\n");b=b.replace(/^\n/,"");b=b.replace(/\n+$/g,"");return b="\n\n~K"+(d.push(b)-1)+"K\n\n"},j=function(c){for(var c=z(c),a=k("<hr />"),c=c.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,a),c=c.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,a),c=c.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,a),c=u(c),c=A(c),c=C(c),c=g(c),c=c.replace(/^\n+/g,""),c=c.replace(/\n+$/g,
""),b=c.split(/\n{2,}/g),c=[],a=b.length,e=0;e<a;e++){var i=b[e];i.search(/~K(\d+)K/g)>=0?c.push(i):i.search(/\S/)>=0&&(i=n(i),i=i.replace(/^([ \t]*)/g,"<p>"),i+="</p>",c.push(i))}a=c.length;for(e=0;e<a;e++)for(;c[e].search(/~K(\d+)K/)>=0;)b=d[RegExp.$1],b=b.replace(/\$/g,"$$$$"),c[e]=c[e].replace(/~K\d+K/,b);return c=c.join("\n\n")},n=function(a){a=B(a);a=q(a);a=a.replace(/\\(\\)/g,s);a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,s);a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,o);a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,
o);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,f);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,f);a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,f);a=D(a);a=y(a);a=a.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>");a=a.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>");return a=a.replace(/  +\n/g," <br />\n")},q=function(a){return a=a.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi,
function(a){a=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return a=p(a,"\\`*_")})},f=function(c,d,e,l,i,f,h,g){g==void 0&&(g="");c=l.toLowerCase();if(i=="")if(c==""&&(c=e.toLowerCase().replace(/ ?\n/g," ")),a[c]!=void 0)i=a[c],b[c]!=void 0&&(g=b[c]);else if(d.search(/\(\s*\)$/m)>-1)i="";else return d;i=p(i,"*_");d='<a href="'+i+'"';g!=""&&(g=g.replace(/"/g,"&quot;"),g=p(g,"*_"),d+=' title="'+g+'"');d+=">"+e+"</a>";return d},o=function(c,d,e,l,i,f,g,h){c=e;l=l.toLowerCase();h||(h="");if(i=="")if(l==""&&
(l=c.toLowerCase().replace(/ ?\n/g," ")),a[l]!=void 0)i=a[l],b[l]!=void 0&&(h=b[l]);else return d;c=c.replace(/"/g,"&quot;");i=p(i,"*_");d='<img src="'+i+'" alt="'+c+'"';h=h.replace(/"/g,"&quot;");h=p(h,"*_");d+=' title="'+h+'"';d+=" />";return d},z=function(a){a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,c){return k("<h1>"+n(c)+"</h1>")});a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,c){return k("<h2>"+n(c)+"</h2>")});return a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,
c,b){a=c.length;return k("<h"+a+">"+n(b)+"</h"+a+">")})},r,u=function(a){a+="~0";var b=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;e?a=a.replace(b,function(a,c,b){a=c;b=b.search(/[*+-]/g)>-1?"ul":"ol";a=a.replace(/\n{2,}/g,"\n\n\n");a=r(a);a=a.replace(/\s+$/,"");return"<"+b+">"+a+"</"+b+">\n"}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,c,b,d){a=b;d=d.search(/[*+-]/g)>
-1?"ul":"ol";a=a.replace(/\n{2,}/g,"\n\n\n");a=r(a);return c+"<"+d+">\n"+a+"</"+d+">\n"}));return a=a.replace(/~0/,"")};r=function(a){e++;a=a.replace(/\n{2,}$/,"\n");a+="~0";a=a.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(a,c,b,d,e){a=e;c||a.search(/\n{2,}/)>-1?a=j(t(a)):(a=u(t(a)),a=a.replace(/\n$/,""),a=n(a));return"<li>"+a+"</li>\n"});a=a.replace(/~0/g,"");e--;return a};var A=function(a){a+="~0";a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,
function(a,b,c){a=v(t(b));a=w(a);a=a.replace(/^\n+/g,"");a=a.replace(/\n+$/g,"");return k("<pre><code>"+a+"\n</code></pre>")+c});return a=a.replace(/~0/,"")},k=function(a){a=a.replace(/(^\n+|\n+$)/g,"");return"\n\n~K"+(d.push(a)-1)+"K\n\n"},B=function(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d){a=d.replace(/^([ \t]*)/g,"");a=a.replace(/[ \t]*$/g,"");a=v(a);return b+"<code>"+a+"</code>"})},v=function(a){a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,
"&gt;");return a=p(a,"*_{}[]\\",!1)},C=function(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c;c=b.replace(/^[ \t]*>[ \t]?/gm,"~0");c=c.replace(/~0/g,"");c=c.replace(/^[ \t]+$/gm,"");c=j(c);c=c.replace(/(^|\n)/g,"$1  ");c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c;c=b.replace(/^  /mg,"~0");return c=c.replace(/~0/g,"")});return k("<blockquote>\n"+c+"\n</blockquote>")})},y=function(a){a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");return a=
a.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},D=function(a){a=a.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>');return a=a.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(a,b){return E(x(b))})},E=function(a){var b=[function(a){return"&#"+a.charCodeAt(0)+";"},function(a){a=a.charCodeAt(0);return"&#x"+("0123456789ABCDEF".charAt(a>>4)+"0123456789ABCDEF".charAt(a&15))+";"},function(a){return a}],a=("mailto:"+a).replace(/./g,function(a){if(a=="@")a=b[Math.floor(Math.random()*
2)](a);else if(a!=":")var c=Math.random(),a=c>0.9?b[2](a):c>0.45?b[1](a):b[0](a);return a});return a=('<a href="'+a+'">'+a+"</a>").replace(/">.+:/g,'">')},x=function(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)})},t=function(a){a=a.replace(/^(\t|[ ]{1,4})/gm,"~0");return a=a.replace(/~0/g,"")},w=function(a){a=a.replace(/\t(?=\t)/g,"    ");a=a.replace(/\t/g,"~A~B");a=a.replace(/~B(.+?)~A/g,function(a,b){for(var c=b,d=4-c.length%4,e=0;e<d;e++)c+=" ";
return c});a=a.replace(/~A/g,"    ");return a=a.replace(/~B/g,"")},p=function(a,b,d){b="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";d&&(b="\\\\"+b);return a=a.replace(RegExp(b,"g"),s)},s=function(a,b){return"~E"+b.charCodeAt(0)+"E"}}};var clientLib=require("com.pageforest.client"),dom=require("org.startpad.dom"),format=require("org.startpad.format"),markdown=new Showdown.converter;exports.extend({onReady:onReady,getDoc:getDoc,setDoc:setDoc,onSaveSuccess:onSaveSuccess,handleLocationHash:handleLocationHash,setCursorPos:setCursorPos,getDocid:getDocid,setDocid:setDocid});
var startTime=Math.floor((new Date).getTime()/1E3),client,doc,blob,latestText="",renderedText="",syncTime=5,editVisible=!1,editorInitialized=!1,editTimer,EDIT_BUFFER=1E3,currentScale,currentShift=0,slideBoundries=[],curBoundriesText="",onReadyFlag,BASE_HEIGHT=140,BUTTON_HEIGHT=38,IDEAL_WIDTH=1300,COMPRESSED_WIDTH=900,HEIGHT=700,OUTPUT_WIDTH=0.9,OUTPUT_WIDTH_EDIT=0.4317,stockCode={};function getDocid(){return handleLocationHash().doc}function setDocid(a){handleLocationHash({doc:a})}
function handleLocationHash(a){var b=document.location.hash.replace(/#/,""),d,e;if(b.length>0&&b.search("doc=")==-1&&b.search("page=")==-1)document.location=location.href.replace("#"+b,"#doc="+b);b.search("doc=")>-1&&(d=b.replace("doc=",""),d.search("&")>-1&&(d=d.split("&")[0]));b.search("page=")>-1&&(e=b.split("page="),e=e[e.length-1]);if(a){if(a.doc)d=a.doc;if(a.page)e=a.page;b="#";d&&(b+="doc="+d);e&&(d&&(b+="&"),b+="page="+e);location.replace(b)}return{doc:d,page:e}}
function onEditChange(a){if(a)switch(a.keyCode){case 39:case 37:case 40:case 38:case 34:case 33:return}latestText=doc.editor.value;editTimer==void 0&&(editTimer=setTimeout(render,EDIT_BUFFER));client.setDirty()}
function render(){latestText!=curBoundriesText&&getSlideBoundries();editTimer=void 0;renderedText!=latestText&&(editTimer=setTimeout(render,EDIT_BUFFER),$(doc.output).html("<section class='slides'>"+latestText+"</section>"),renderedText=latestText,refresh(),tooFarInFuture(),onResize(),setSlidePosFromCursor())}function tooFarInFuture(){curSlide<slideEls.length||(slideEls.length==0&&adjustSlidePos(0),adjustSlidePos(slideEls.length-1))}
function adjustSlidePos(a){a-=curSlide;var b;if(a!==0)if(a>0)for(b=0;b<a;b++)for(var d=curSlide;curSlide==d&&curSlide<slideEls.length-1;)nextSlide("automated");else for(b=0;b<-a;b++)prevSlide("automated")}function toggleEditor(){(editVisible=!editVisible)?($(doc.page).addClass("edit"),editorInitialized||(editorInitialized=!0,$(doc.editor).bind("keyup",onEditChange))):$(doc.page).removeClass("edit");onResize();$(doc.edit).val(editVisible?"Full":"Edit")}
function insertStockCode(){var a,b,d;if(a=trimCode(stockCode[$(doc.select).val()]))b=$(doc.editor).val(),d=b.slice(doc.editor.selectionEnd),d.indexOf("<article")==-1?a=b+"\n"+a:(d=doc.editor.selectionEnd+d.indexOf("<article"),a=b.slice(0,d)+a+"\n"+b.slice(d)),$(doc.editor).val(a),onEditChange()}
function trimCode(a){var a=a.replace(/^\n+|\s+$/g,""),b=/^\s+/.exec(a);if(b){for(var b=RegExp("^\\s{"+b[0].length+"}"),a=a.split("\n"),d=0;d<a.length;d++)a[d]=a[d].replace(b,"");a=a.join("\n")}return a+"\n"}
function onReady(){handleAppCache();doc=dom.bindIDs();client=new clientLib.Client(exports);client.saveInterval=0;client.addAppBar();$(doc.edit).click(toggleEditor);$(doc.insert).click(insertStockCode);$(doc.editor).keydown(tabToSpace);$(doc.editor).bind("keydown click",setSlidePosFromCursor);$(window).bind("resize",onResize);$(doc.fullscreen).bind("click",viewSlideshowFullscreen);$(doc.next).click(nextSlide);$(doc.prev).click(prevSlide);$(doc.output).html("<section class='slides'><article></article></section>");
handleDomLoaded();handleLocationHash().doc||$.ajax({url:"slides.html",error:function(){console.log("ajax load error")},success:function(a){setDoc({title:"Editable HTML5 Slides",blob:{version:1.1,slides:a}})}});for(var a=$("script[type=slide-template]"),b,d=0;d<a.length;d++)b=a[d],stockCode[b.title]=$(b).text();onReadyFlag=!0}
function viewSlideshowFullscreen(){client.docid==void 0?(event.preventDefault(),alert("You have to save a document to view it fullscreen")):client.state!="clean"&&alert("Warning, the current slideshow has not been saved")}function modifyFullscreenURL(){client.docid!=void 0&&$(doc.fullscreen).attr("href",location.href.replace(/page=[0-9]+/,"").replace("doc=","docs/").replace("#","").replace("&","")+"/slides")}
function getSlideBoundries(){var a,b,d=0,e=$(doc.editor).val();b=slideBoundries=[0];for(a=e.indexOf("</article>")+10;a>9;)d+=a,b[b.length]=d,e=e.slice(a),a=e.indexOf("</article>")+10;curBoundriesText=latestText}
function setSlidePosFromCursor(){if(!(doc.editor.selectionEnd>slideBoundries[curSlide]&&doc.editor.selectionEnd<slideBoundries[curSlide+1])){for(var a=1;a<slideBoundries.length;a++)if(slideBoundries[a]>=doc.editor.selectionEnd){adjustSlidePos(a-1);return}adjustSlidePos(slideEls.length-1)}}
function setCursorPos(){$(doc.phantomPre).text($(doc.editor).val().slice(0,slideBoundries[curSlide]));var a=doc.phantom.offsetHeight;a<100&&(a=0);doc.editor.selectionStart=slideBoundries[curSlide];doc.editor.selectionEnd=slideBoundries[curSlide];$(doc.editor).scrollTop(a);$(doc.editor).blur()}function tabToSpace(a){if(a.keyCode==9){var b=this.selectionStart;a.preventDefault();a=$(this).val();a=a.slice(0,b)+"  "+a.slice(b);$(this).val(a);this.selectionEnd=this.selectionStart=b+2}}
function positionNav(){if(editVisible){var a=doc.output.offsetHeight*currentScale+window.scrollY;$(doc.nav).css("top",a+"px")}else $(doc.nav).css("top",doc.outputBlock.offsetHeight-35+"px")}
function onResize(){var a=editVisible?COMPRESSED_WIDTH:IDEAL_WIDTH,b,d;editVisible?(b=window.innerHeight-BASE_HEIGHT-BUTTON_HEIGHT,d=window.innerWidth*OUTPUT_WIDTH_EDIT,b/HEIGHT>d/COMPRESSED_WIDTH?(currentScale=doc.outputBlock.offsetWidth/a,currentShift>0&&(currentShift=0)):(currentScale=b/HEIGHT,currentShift=(d-COMPRESSED_WIDTH*currentScale)/2),$(doc.editor).css("height",window.innerHeight-BASE_HEIGHT),$(doc.outputBlock).css("height",window.innerHeight-BASE_HEIGHT)):(b=window.innerHeight-BASE_HEIGHT-
BUTTON_HEIGHT,d=window.innerWidth*OUTPUT_WIDTH,b/HEIGHT>d/IDEAL_WIDTH?(currentScale=d/IDEAL_WIDTH,currentShift=0):(currentScale=b/HEIGHT,currentShift=(d-IDEAL_WIDTH*currentScale)/2),$(doc.outputBlock).css("height",currentScale*HEIGHT+BUTTON_HEIGHT+"px"));$(doc.phantom).css("width",doc.editor.scrollWidth+"px");setCrossTransform(doc.output,"transform");positionNav()}
function setCrossTransform(a,b){var d="translate("+currentShift+"px, 0px) scale("+currentScale+")";$(a).css("-webkit-"+b,d);$(a).css("-moz-"+b,d);$(a).css("-o-"+b,d);$(a).css("-ms-"+b,d);$(a).css(b,d)}function updateMeta(a){document.title=a.title;$("#title").text(a.title);modifyFullscreenURL()}
function onSaveSuccess(){updateMeta(client.meta);client.storage.putBlob(client.docid,"slides","<!DOCTYPE html>\n<\!--\nGoogle HTML5 slide template  Authors: Luke Mahe (code)\nMarcin Wichary (code and design)\nDominic Mazzoni (browser compatibility)\nCharles Chen (ChromeVox support)\nURL: http://code.google.com/p/html5slides/\n--\>\n<html>\n  <head>\n  <title>Presentation</title>\n    <meta charset='utf-8'>\n    <script src='http://html5slides.googlecode.com/svn/trunk/slides.js'><\/script>\n</head><body style='display: none'>    <section class='slides'>"+renderedText+
"</section></body></html>")}
<<<<<<< HEAD
function setDoc(a){console.log("setDoc()");a.blob.version===1?latestText=a.blob.markdown:a.blob.version===1.1?latestText=a.blob.slides:console.log("ERROR: unknown blob version number");renderedText=doc.editor.value=latestText;$(doc.output).css("visibility","hidden");$(doc.output).html("<section class='slides'>"+latestText+"</section>");refresh();getSlideBoundries();setCursorPos();onResize();$(doc.output).css("visibility","visible");tooFarInFuture();onReadyFlag&&(toggleEditor(),onReadyFlag=!1);updateMeta(a)}
=======
function setDoc(a){console.log("setDoc()");a.blob.version===1?latestText=a.blob.markdown:a.blob.version===1.1?latestText=a.blob.slides:console.log("ERROR: unknown blob version number");renderedText=doc.editor.value=latestText;$(doc.output).css("visibility","hidden");$(doc.output).html("<section class='slides'>"+latestText+"</section>");refresh();getSlideBoundries();setCursorPos();onResize();$(doc.output).css("visibility","visible");onReadyFlag&&(toggleEditor(),onReadyFlag=!1);updateMeta(a)}
>>>>>>> ce20d91efe11b6a67bb78929efe414a402fb5327
>>>>>>> 07bccc0cae257efaa87fd60bd8e36be3f1a978c0
function getDoc(){return{blob:{version:1.1,slides:doc.editor.value},readers:["public"]}}function handleAppCache(){typeof applicationCache!="undefined"&&(applicationCache.status==applicationCache.UPDATEREADY?(applicationCache.swapCache(),location.reload()):applicationCache.addEventListener("updateready",handleAppCache,!1))};