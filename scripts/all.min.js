(function(b){function c(){}function d(b){if(!b)return 0;b=b.split(".");return 1E4*parseInt(b[0])+100*parseInt(b[1])+parseInt(b[2])}function e(b){for(var b=b.replace(/-/g,"_"),b=b.split("."),d=f,e=0;e<b.length;e++)d[b[e]]===void 0&&(d[b[e]]=new c),d=d[b[e]];return d}var f=b.namespace;if(f){if(d("3.0.1")<=d(f.VERSION))return;c=f.constructor}else b.namespace=f=new c;f.VERSION="3.0.1";b=c.prototype;b.module=function(b,c){var d=e(b);c&&c(d,e);return d};b.extend=function(b){for(var c in b)b.hasOwnProperty(c)&&
(this[c]=b[c])}})(this);
namespace.module("org.startpad.types",function(b){function c(b,c){return d(b)==c}function d(b){if(b===void 0)return"undefined";if(b===null)return"null";var c=Object.prototype.toString.call(b).match(/\[object (.*)\]/)[1].toLowerCase();e.indexOf(c)==-1&&(c=typeof b);return c}b.extend({VERSION:"0.1.0",isArguments:function(b){return c(b,"arguments")},isArray:function(b){return c(b,"array")},copyArray:function(b){return Array.prototype.slice.call(b)},isType:c,typeOf:d,extend:function(b){var c,d,e,g;b===
void 0&&(b={});for(c=1;c<arguments.length;c++){e=arguments[c];for(g in e)e.hasOwnProperty(g)&&(b[g]=e[g]);if(f)for(d=0;d<h.length;d++)g=h[d],e.hasOwnProperty(g)&&(b[g]=e[g])}return b},project:function(b,c){for(var d={},e=0;e<c.length;e++){var g=c[e];b&&b.hasOwnProperty(g)&&(d[g]=b[g])}return d},getFunctionName:function(b){if(typeof b=="function"){b=b.toString().match(/function\s*(\S+)\s*\(/);if(!b)return"";return b[1]}}});var e=["number","string","boolean","array","function","date","regexp","arguments",
"undefined","null"],f=!{toString:!0}.propertyIsEnumerable("toString"),h=["toString","toLocaleString","valueOf","constructor","isPrototypeOf"]});
namespace.module("org.startpad.funcs",function(b,c){function d(b){if(!b)return 0;b=b.split(".");return 1E4*parseInt(b[0])+100*parseInt(b[1])+parseInt(b[2])}function e(b,c,e,g){if(!(b._patches&&d(b._patches[c])>=d(e)))b._patches=b._patches||{},b._patches[c]=e,f(b,g)}function f(b,c){g.extend(b.prototype,c)}function h(b,c){function d(b,c){for(var e=g.copyArray(b),c=g.copyArray(c),n=0;n<e.length;n++)e[n]===void 0&&(e[n]=c.shift());return e.concat(c)}var e;e=arguments.length==3&&g.isArguments(arguments[2])?
Array.prototype.slice.call(arguments[2],self1):Array.prototype.slice.call(arguments,2);return function(){return b.apply(c||this,d(e,arguments))}}function k(b,c){function d(){return c.call(this,b,arguments,d)}c.call(b,void 0,arguments,d);return d}function q(b){function c(){}c.prototype=b;return new c}function m(c,d,e){c.prototype=b.create(d.prototype);c.prototype.constructor=c;f(c,e)}function r(c,d){for(var e=c.pop().prototype,h;c.length>0;){h=c.pop();var k=g.getFunctionName(h),j=b.create(e);g.extend(j,
h.prototype);j.constructor=h;j[k+"_super"]=e;e=j}h.prototype=e;f(h,d)}var g=c("org.startpad.types");b.extend({VERSION:"0.3.0",methods:f,bind:h,decorate:k,create:Object.create||q,subclass:m,mro:r,numericVersion:d,monkeyPatch:e,patch:function(){e(Function,"org.startpad.funcs",b.VERSION,{methods:function(b){f(this,b)},curry:function(){var b=[this,void 0].concat(g.copyArray(arguments));return h.apply(void 0,b)},curryThis:function(){var b=g.copyArray(arguments);b.unshift(this);return h.apply(void 0,b)},
decorate:function(b){return k(this,b)},subclass:function(b,c){m(this,b,c)},mro:function(b,c){b.unshift(this);r(b,c)}});return b}})});
namespace.module("org.startpad.string",function(b,c){function d(b,c,d){d=d||f;if(b==void 0)return"undefined";b=b.toString();return b=b.replace(d,function(b,d){for(var e=c,f=d.split("."),h=0;h<f.length;h++){var d=f[h],o=parseInt(d),e=isNaN(o)?e[d]:e[o];if(e==void 0)return""}return e})}var e=c("org.startpad.funcs");b.extend({VERSION:"0.1.2",patch:function(){e.monkeyPatch(String,"org.startpad.string",b.VERSION,{format:function(){return arguments.length==1&&typeof arguments[0]=="object"?d(this,arguments[0]):
d(this,arguments)}});return b},format:d});var f=/\{\s*([^} ]+)\s*\}/g});var Showdown={converter:function(){var b,c,d,e=0;this.makeHtml=function(a){b=[];c=[];d=[];a=a.replace(/~/g,"~T");a=a.replace(/\$/g,"~D");a=a.replace(/\r\n/g,"\n");a=a.replace(/\r/g,"\n");a=w("\n\n"+a+"\n\n");a=a.replace(/^[ \t]+$/mg,"");a=h(a);a=f(a);a=q(a);a=x(a);a=a.replace(/~D/g,"$$");return a=a.replace(/~T/g,"~")};var f=function(a){return a=a.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,function(a,d,e,i,g){d=d.toLowerCase();b[d]=
y(e);if(i)return i+g;else g&&(c[d]=g.replace(/"/g,"&quot;"));return""})},h=function(a){a=a.replace(/\n/g,"\n\n");a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,k);a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,k);a=a.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,k);a=a.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,
k);a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,k);return a=a.replace(/\n\n/g,"\n")},k=function(a,b){var c;c=b.replace(/\n\n/g,"\n");c=c.replace(/^\n/,"");c=c.replace(/\n+$/g,"");return c="\n\n~K"+(d.push(c)-1)+"K\n\n"},q=function(a){for(var a=z(a),b=j("<hr />"),a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,b),a=u(a),a=A(a),a=C(a),a=h(a),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,
""),c=a.split(/\n{2,}/g),a=[],b=c.length,e=0;e<b;e++){var i=c[e];i.search(/~K(\d+)K/g)>=0?a.push(i):i.search(/\S/)>=0&&(i=m(i),i=i.replace(/^([ \t]*)/g,"<p>"),i+="</p>",a.push(i))}b=a.length;for(e=0;e<b;e++)for(;a[e].search(/~K(\d+)K/)>=0;)c=d[RegExp.$1],c=c.replace(/\$/g,"$$$$"),a[e]=a[e].replace(/~K\d+K/,c);return a=a.join("\n\n")},m=function(a){a=B(a);a=r(a);a=a.replace(/\\(\\)/g,s);a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,s);a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,n);a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,
n);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,g);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,g);a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,g);a=D(a);a=y(a);a=a.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>");a=a.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>");return a=a.replace(/  +\n/g," <br />\n")},r=function(a){return a=a.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi,
function(a){a=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return a=p(a,"\\`*_")})},g=function(a,d,e,l,i,g,f,h){h==void 0&&(h="");a=l.toLowerCase();if(i=="")if(a==""&&(a=e.toLowerCase().replace(/ ?\n/g," ")),b[a]!=void 0)i=b[a],c[a]!=void 0&&(h=c[a]);else if(d.search(/\(\s*\)$/m)>-1)i="";else return d;i=p(i,"*_");d='<a href="'+i+'"';h!=""&&(h=h.replace(/"/g,"&quot;"),h=p(h,"*_"),d+=' title="'+h+'"');d+=">"+e+"</a>";return d},n=function(a,d,e,l,i,g,h,f){a=e;l=l.toLowerCase();f||(f="");if(i=="")if(l==""&&
(l=a.toLowerCase().replace(/ ?\n/g," ")),b[l]!=void 0)i=b[l],c[l]!=void 0&&(f=c[l]);else return d;a=a.replace(/"/g,"&quot;");i=p(i,"*_");d='<img src="'+i+'" alt="'+a+'"';f=f.replace(/"/g,"&quot;");f=p(f,"*_");d+=' title="'+f+'"';d+=" />";return d},z=function(a){a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,b){return j("<h1>"+m(b)+"</h1>")});a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,b){return j("<h2>"+m(b)+"</h2>")});return a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,
b,c){a=b.length;return j("<h"+a+">"+m(c)+"</h"+a+">")})},o,u=function(a){a+="~0";var b=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;e?a=a.replace(b,function(a,b,c){a=b;c=c.search(/[*+-]/g)>-1?"ul":"ol";a=a.replace(/\n{2,}/g,"\n\n\n");a=o(a);a=a.replace(/\s+$/,"");return"<"+c+">"+a+"</"+c+">\n"}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,b,c,d){a=c;d=d.search(/[*+-]/g)>
-1?"ul":"ol";a=a.replace(/\n{2,}/g,"\n\n\n");a=o(a);return b+"<"+d+">\n"+a+"</"+d+">\n"}));return a=a.replace(/~0/,"")};o=function(a){e++;a=a.replace(/\n{2,}$/,"\n");a+="~0";a=a.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(a,b,c,d,e){a=e;b||a.search(/\n{2,}/)>-1?a=q(t(a)):(a=u(t(a)),a=a.replace(/\n$/,""),a=m(a));return"<li>"+a+"</li>\n"});a=a.replace(/~0/g,"");e--;return a};var A=function(a){a+="~0";a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,
function(a,b,c){a=v(t(b));a=w(a);a=a.replace(/^\n+/g,"");a=a.replace(/\n+$/g,"");return j("<pre><code>"+a+"\n</code></pre>")+c});return a=a.replace(/~0/,"")},j=function(a){a=a.replace(/(^\n+|\n+$)/g,"");return"\n\n~K"+(d.push(a)-1)+"K\n\n"},B=function(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d){a=d.replace(/^([ \t]*)/g,"");a=a.replace(/[ \t]*$/g,"");a=v(a);return b+"<code>"+a+"</code>"})},v=function(a){a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,
"&gt;");return a=p(a,"*_{}[]\\",!1)},C=function(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c;c=b.replace(/^[ \t]*>[ \t]?/gm,"~0");c=c.replace(/~0/g,"");c=c.replace(/^[ \t]+$/gm,"");c=q(c);c=c.replace(/(^|\n)/g,"$1  ");c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c;c=b.replace(/^  /mg,"~0");return c=c.replace(/~0/g,"")});return j("<blockquote>\n"+c+"\n</blockquote>")})},y=function(a){a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");return a=
a.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},D=function(a){a=a.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>');return a=a.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(a,b){return E(x(b))})},E=function(a){var b=[function(a){return"&#"+a.charCodeAt(0)+";"},function(a){a=a.charCodeAt(0);return"&#x"+("0123456789ABCDEF".charAt(a>>4)+"0123456789ABCDEF".charAt(a&15))+";"},function(a){return a}],a=("mailto:"+a).replace(/./g,function(a){if(a=="@")a=b[Math.floor(Math.random()*
2)](a);else if(a!=":")var c=Math.random(),a=c>0.9?b[2](a):c>0.45?b[1](a):b[0](a);return a});return a=('<a href="'+a+'">'+a+"</a>").replace(/">.+:/g,'">')},x=function(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)})},t=function(a){a=a.replace(/^(\t|[ ]{1,4})/gm,"~0");return a=a.replace(/~0/g,"")},w=function(a){a=a.replace(/\t(?=\t)/g,"    ");a=a.replace(/\t/g,"~A~B");a=a.replace(/~B(.+?)~A/g,function(a,b){for(var c=b,d=4-c.length%4,e=0;e<d;e++)c+=" ";
return c});a=a.replace(/~A/g,"    ");return a=a.replace(/~B/g,"")},p=function(a,b,c){b="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(b="\\\\"+b);return a=a.replace(RegExp(b,"g"),s)},s=function(a,b){return"~E"+b.charCodeAt(0)+"E"}}};var clientLib=require("com.pageforest.client"),dom=require("org.startpad.dom"),format=require("org.startpad.format"),markdown=new Showdown.converter;exports.extend({onReady:onReady,onReadyIndex:onReadyIndex,getDoc:getDoc,setDoc:setDoc,onSaveSuccess:onSaveSuccess,handleLocationHash:handleLocationHash,getDocid:getDocid,setDocid:setDocid});
var client,doc,blob,lastText="",syncTime=5,editVisible=!1,editorInitialized=!1,editTimer,EDIT_BUFFER=1E3,currentScale,currentScroll=0,index=!1,slideBoundries=[],BASE_HEIGHT=130,BUTTON_HEIGHT=40,IDEAL_WIDTH=1300,COMPRESSED_WIDTH=900,HEIGHT=700,OUTPUT_WIDTH=0.9,OUTPUT_WIDTH_EDIT=0.4317,stockCode={};function getDocid(){return handleLocationHash().doc}function setDocid(b){handleLocationHash({doc:b})}
function handleLocationHash(b){var c=document.location.hash.replace(/#/,""),d,e;if(c.length>0&&c.search("doc=")==-1&&c.search("page=")==-1)document.location=location.href.replace("#"+c,"#doc="+c);c.search("doc=")>-1&&(d=c.replace("doc=",""),d.search("&")>-1&&(d=d.split("&")[0]));c.search("page=")>-1&&(e=c.split("page="),e=e[e.length-1]);if(b){if(b.doc)d=b.doc;if(b.page)e=b.page;c="#";d&&(c+="doc="+d);e&&(d&&(c+="&"),c+="page="+e);location.replace(c)}return{doc:d,page:e}}
function onEditChange(b){if(b)switch(b.keyCode){case 39:case 37:case 40:case 38:case 34:case 33:return}editTimer&&clearTimeout(editTimer);b=doc.editor.value;b!=lastText&&(client.setDirty(),lastText=b,editTimer=setTimeout(render,EDIT_BUFFER))}function render(){editTimer&&clearTimeout(editTimer);$(doc.output).html("<section class='slides'>"+lastText+"</section>");refresh();tooFarInFuture();onResize()}function tooFarInFuture(){curSlide<slideEls.length||adjustSlidePos(slideEls.length-1)}
function adjustSlidePos(b){b-=curSlide;if(b!==0)if(b>0)for(var c=0;c<b;c++)nextSlide();else for(c=0;c<-b;c++)prevSlide()}function toggleEditor(){(editVisible=!editVisible)?($(doc.page).addClass("edit"),editorInitialized||(editorInitialized=!0,$(doc.editor).bind("keyup",onEditChange))):(render(),$(doc.page).removeClass("edit"),currentScroll=0);onResize();$(doc.edit).val(editVisible?"hide":"edit")}
function insertStockCode(){var b,c,d;if(b=trimCode(stockCode[$(doc.select).val()]))c=$(doc.editor).val(),d=c.slice(doc.editor.selectionEnd),d.indexOf("<article")==-1?$(doc.editor).val(c+"\n"+b):(d=doc.editor.selectionEnd+d.indexOf("<article"),b=c.slice(0,d)+b+"\n"+c.slice(d),$(doc.editor).val(b),onEditChange())}
function trimCode(b){var b=b.replace(/^\n+|\s+$/g,""),c=/^\s+/.exec(b);if(c){for(var c=RegExp("^\\s{"+c[0].length+"}"),b=b.split("\n"),d=0;d<b.length;d++)b[d]=b[d].replace(c,"");b=b.join("\n")}return b+"\n"}
function onReady(){handleAppCache();doc=dom.bindIDs();client=new clientLib.Client(exports);client.saveInterval=0;client.addAppBar();$(doc.edit).click(toggleEditor);$(doc.insert).click(insertStockCode);$(doc.editor).keydown(tabToSpace);for(var b=$("script[type=slide-template]"),c,d=0;d<b.length;d++)c=b[d],stockCode[c.title]=$(c).text();$(doc.editor).bind("keydown click focus",findSlideBoundries);$.ajax({url:"slides.html",error:function(){console.log("ajax load error")},success:function(b){lastText=
b;doc.editor.value=b;b=document.createElement("script");b.type="text/javascript";b.src="scripts/slides.js";b.onload=function(){render();handleDomLoaded();$(doc.next).click(nextSlide);$(doc.prev).click(prevSlide)};document.body.appendChild(b)}});$(window).bind("resize",onResize)}
function findSlideBoundries(){var b,c,d=0,e=$(doc.editor).val(),f=!1;c=slideBoundries=[0];for(b=e.indexOf("</article>")+10;b>9;)d+=b,c[c.length]=d,e=e.slice(b),b=e.indexOf("</article>")+10,!f&&d>doc.editor.selectionEnd&&(adjustSlidePos(slideBoundries.length-2),f=!0)}function tabToSpace(b){if(b.keyCode==9){var c=this.selectionStart;b.preventDefault();b=$(this).val();b=b.slice(0,c)+"  "+b.slice(c);$(this).val(b);this.selectionEnd=this.selectionStart=c+2}}
function positionNav(){if(editVisible){var b=doc.output.offsetHeight*currentScale+window.scrollY;$(doc.nav).css("top",b+"px")}else $(doc.nav).css("top",doc.outputBlock.offsetHeight-35+"px")}
function onResize(){var b=editVisible?COMPRESSED_WIDTH:IDEAL_WIDTH;if(editVisible){var c=window.innerHeight-BASE_HEIGHT-BUTTON_HEIGHT,d=window.innerWidth*OUTPUT_WIDTH_EDIT;c/HEIGHT>d/COMPRESSED_WIDTH?(currentScale=doc.outputBlock.offsetWidth/b,currentShift>0&&(currentShift=0)):(currentScale=c/HEIGHT,currentShift=(d-COMPRESSED_WIDTH*currentScale)/2);$(doc.editor).css("height",window.innerHeight-BASE_HEIGHT);$(doc.outputBlock).css("height",window.innerHeight-BASE_HEIGHT)}else c=window.innerHeight-BASE_HEIGHT-
BUTTON_HEIGHT,d=window.innerWidth*OUTPUT_WIDTH,c/HEIGHT>d/IDEAL_WIDTH?(currentScale=d/IDEAL_WIDTH,currentShift=0):(currentScale=c/HEIGHT,currentShift=(d-IDEAL_WIDTH*currentScale)/2),$(doc.outputBlock).css("height",currentScale*HEIGHT+BUTTON_HEIGHT+"px");setCrossTransform(doc.output,"transform");positionNav()}
function setCrossTransform(b,c){var d="translate("+currentShift+"px, "+currentScroll+"px) scale("+currentScale+")";$(b).css("-webkit-"+c,d);$(b).css("-moz-"+c,d);$(b).css("-o-"+c,d);$(b).css("-ms-"+c,d);$(b).css(c,d)}function updateMeta(b){document.title=b.title;$("#title").text(b.title)}function onSaveSuccess(){updateMeta(client.meta)}
function onReadyIndex(){if(!document.location.hash)document.location="http://html5slides.pageforest.com/editor";index=!0;handleAppCache();doc=dom.bindIDs();client=new clientLib.Client(exports);client.saveInterval=0;$(document.body).addClass("index")}
function setDoc(b){index?(document.body.innerHTML=wrap(b.blob.markdown),b=document.createElement("script"),b.type="text/javascript",b.src="scripts/slides.js",b.onload=function(){handleDomLoaded()},document.body.appendChild(b)):(doc.editor.value=b.blob.markdown,onEditChange(),updateMeta(b))}function getDoc(){if(!index)return{blob:{version:1,markdown:doc.editor.value},readers:["public"]}}
function handleAppCache(){typeof applicationCache!="undefined"&&(applicationCache.status==applicationCache.UPDATEREADY?(applicationCache.swapCache(),location.reload()):applicationCache.addEventListener("updateready",handleAppCache,!1))};