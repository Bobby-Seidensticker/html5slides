(function(b){function e(){}function c(b){if(!b)return 0;b=b.split(".");return 1E4*parseInt(b[0])+100*parseInt(b[1])+parseInt(b[2])}function d(b){for(var b=b.replace(/-/g,"_"),b=b.split("."),f=j,c=0;c<b.length;c++)f[b[c]]===void 0&&(f[b[c]]=new e),f=f[b[c]];return f}var j=b.namespace;if(j){if(c("3.0.1")<=c(j.VERSION))return;e=j.constructor}else b.namespace=j=new e;j.VERSION="3.0.1";b=e.prototype;b.module=function(b,f){var c=d(b);f&&f(c,d);return c};b.extend=function(b){for(var f in b)b.hasOwnProperty(f)&&
(this[f]=b[f])}})(this);
namespace.module("org.startpad.types",function(b){function e(b,e){return c(b)==e}function c(b){if(b===void 0)return"undefined";if(b===null)return"null";var c=Object.prototype.toString.call(b).match(/\[object (.*)\]/)[1].toLowerCase();d.indexOf(c)==-1&&(c=typeof b);return c}b.extend({VERSION:"0.1.0",isArguments:function(b){return e(b,"arguments")},isArray:function(b){return e(b,"array")},copyArray:function(b){return Array.prototype.slice.call(b)},isType:e,typeOf:c,extend:function(b){var c,e,d,h;b===
void 0&&(b={});for(c=1;c<arguments.length;c++){d=arguments[c];for(h in d)d.hasOwnProperty(h)&&(b[h]=d[h]);if(j)for(e=0;e<i.length;e++)h=i[e],d.hasOwnProperty(h)&&(b[h]=d[h])}return b},project:function(b,c){for(var e={},d=0;d<c.length;d++){var h=c[d];b&&b.hasOwnProperty(h)&&(e[h]=b[h])}return e},getFunctionName:function(b){if(typeof b=="function"){b=b.toString().match(/function\s*(\S+)\s*\(/);if(!b)return"";return b[1]}}});var d=["number","string","boolean","array","function","date","regexp","arguments",
"undefined","null"],j=!{toString:!0}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","constructor","isPrototypeOf"]});
namespace.module("org.startpad.funcs",function(b,e){function c(b){if(!b)return 0;b=b.split(".");return 1E4*parseInt(b[0])+100*parseInt(b[1])+parseInt(b[2])}function d(b,e,d,h){if(!(b._patches&&c(b._patches[e])>=c(d)))b._patches=b._patches||{},b._patches[e]=d,j(b,h)}function j(b,c){h.extend(b.prototype,c)}function i(b,c){function e(b,c){for(var d=h.copyArray(b),c=h.copyArray(c),m=0;m<d.length;m++)d[m]===void 0&&(d[m]=c.shift());return d.concat(c)}var d;d=arguments.length==3&&h.isArguments(arguments[2])?
Array.prototype.slice.call(arguments[2],self1):Array.prototype.slice.call(arguments,2);return function(){return b.apply(c||this,e(d,arguments))}}function f(b,c){function d(){return c.call(this,b,arguments,d)}c.call(b,void 0,arguments,d);return d}function k(b){function c(){}c.prototype=b;return new c}function g(c,d,e){c.prototype=b.create(d.prototype);c.prototype.constructor=c;j(c,e)}function p(c,d){for(var e=c.pop().prototype,f;c.length>0;){f=c.pop();var i=h.getFunctionName(f),g=b.create(e);h.extend(g,
f.prototype);g.constructor=f;g[i+"_super"]=e;e=g}f.prototype=e;j(f,d)}var h=e("org.startpad.types");b.extend({VERSION:"0.3.0",methods:j,bind:i,decorate:f,create:Object.create||k,subclass:g,mro:p,numericVersion:c,monkeyPatch:d,patch:function(){d(Function,"org.startpad.funcs",b.VERSION,{methods:function(b){j(this,b)},curry:function(){var b=[this,void 0].concat(h.copyArray(arguments));return i.apply(void 0,b)},curryThis:function(){var b=h.copyArray(arguments);b.unshift(this);return i.apply(void 0,b)},
decorate:function(b){return f(this,b)},subclass:function(b,c){g(this,b,c)},mro:function(b,c){b.unshift(this);p(b,c)}});return b}})});
namespace.module("org.startpad.string",function(b,e){function c(b,c,d){d=d||j;if(b==void 0)return"undefined";b=b.toString();return b=b.replace(d,function(b,d){for(var e=c,j=d.split("."),i=0;i<j.length;i++){var d=j[i],k=parseInt(d),e=isNaN(k)?e[d]:e[k];if(e==void 0)return""}return e})}var d=e("org.startpad.funcs");b.extend({VERSION:"0.1.2",patch:function(){d.monkeyPatch(String,"org.startpad.string",b.VERSION,{format:function(){return arguments.length==1&&typeof arguments[0]=="object"?c(this,arguments[0]):
c(this,arguments)}});return b},format:c});var j=/\{\s*([^} ]+)\s*\}/g});(function(b){b.fn.autoResize=function(e){var c=b.extend({onResize:function(){},animate:!0,animateDuration:150,animateCallback:function(){},extraSpace:20,limit:1E3},e);this.filter("textarea").each(function(){var d=b(this).css({resize:"none","overflow-y":"hidden"}),e=d.height(),i=function(){var c={};b.each(["height","width","lineHeight","textDecoration","letterSpacing"],function(b,e){c[e]=d.css(e)});return d.clone().removeAttr("id").removeAttr("name").css({position:"absolute",top:0,left:-9999}).css(c).attr("tabIndex",
"-1").insertBefore(d)}(),f=null,k=function(){i.height(0).val(b(this).val()).scrollTop(1E4);var g=Math.max(i.scrollTop(),e)+c.extraSpace,k=b(this).add(i);if(g>=c.limit)b(this).css("overflow-y",""),g=c.limit;f!==g&&(f=g,c.onResize.call(this),c.animate&&d.css("display")==="block"?k.stop().animate({height:g},c.animateDuration,c.animateCallback):k.height(g))};d.unbind(".dynSiz").bind("keyup.dynSiz",k).bind("keydown.dynSiz",k).bind("change.dynSiz",k).trigger("change.dynSiz")});return this}})(jQuery);var Showdown={converter:function(){var b,e,c,d=0;this.makeHtml=function(a){b=[];e=[];c=[];a=a.replace(/~/g,"~T");a=a.replace(/\$/g,"~D");a=a.replace(/\r\n/g,"\n");a=a.replace(/\r/g,"\n");a=v("\n\n"+a+"\n\n");a=a.replace(/^[ \t]+$/mg,"");a=i(a);a=j(a);a=k(a);a=w(a);a=a.replace(/~D/g,"$$");return a=a.replace(/~T/g,"~")};var j=function(a){return a=a.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,function(a,c,d,x,f){c=c.toLowerCase();b[c]=
y(d);if(x)return x+f;else f&&(e[c]=f.replace(/"/g,"&quot;"));return""})},i=function(a){a=a.replace(/\n/g,"\n\n");a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,f);a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,f);a=a.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,f);a=a.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,
f);a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,f);return a=a.replace(/\n\n/g,"\n")},f=function(a,b){var l;l=b.replace(/\n\n/g,"\n");l=l.replace(/^\n/,"");l=l.replace(/\n+$/g,"");return l="\n\n~K"+(c.push(l)-1)+"K\n\n"},k=function(a){for(var a=z(a),b=n("<hr />"),a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,b),a=t(a),a=A(a),a=D(a),a=i(a),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,
""),l=a.split(/\n{2,}/g),a=[],b=l.length,d=0;d<b;d++){var e=l[d];e.search(/~K(\d+)K/g)>=0?a.push(e):e.search(/\S/)>=0&&(e=g(e),e=e.replace(/^([ \t]*)/g,"<p>"),e+="</p>",a.push(e))}b=a.length;for(d=0;d<b;d++)for(;a[d].search(/~K(\d+)K/)>=0;)l=c[RegExp.$1],l=l.replace(/\$/g,"$$$$"),a[d]=a[d].replace(/~K\d+K/,l);return a=a.join("\n\n")},g=function(a){a=B(a);a=p(a);a=a.replace(/\\(\\)/g,r);a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,r);a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,m);a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,
m);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,h);a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,h);a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,h);a=E(a);a=y(a);a=a.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>");a=a.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>");return a=a.replace(/  +\n/g," <br />\n")},p=function(a){return a=a.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi,
function(a){a=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return a=o(a,"\\`*_")})},h=function(a,c,d,C,f,h,j,g){g==void 0&&(g="");a=C.toLowerCase();if(f=="")if(a==""&&(a=d.toLowerCase().replace(/ ?\n/g," ")),b[a]!=void 0)f=b[a],e[a]!=void 0&&(g=e[a]);else if(c.search(/\(\s*\)$/m)>-1)f="";else return c;f=o(f,"*_");c='<a href="'+f+'"';g!=""&&(g=g.replace(/"/g,"&quot;"),g=o(g,"*_"),c+=' title="'+g+'"');c+=">"+d+"</a>";return c},m=function(a,c,d,f,g,h,j,i){a=d;f=f.toLowerCase();i||(i="");if(g=="")if(f==""&&
(f=a.toLowerCase().replace(/ ?\n/g," ")),b[f]!=void 0)g=b[f],e[f]!=void 0&&(i=e[f]);else return c;a=a.replace(/"/g,"&quot;");g=o(g,"*_");c='<img src="'+g+'" alt="'+a+'"';i=i.replace(/"/g,"&quot;");i=o(i,"*_");c+=' title="'+i+'"';c+=" />";return c},z=function(a){a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,b){return n("<h1>"+g(b)+"</h1>")});a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,b){return n("<h2>"+g(b)+"</h2>")});return a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,
b,c){a=b.length;return n("<h"+a+">"+g(c)+"</h"+a+">")})},q,t=function(a){a+="~0";var b=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;d?a=a.replace(b,function(a,b,c){a=b;c=c.search(/[*+-]/g)>-1?"ul":"ol";a=a.replace(/\n{2,}/g,"\n\n\n");a=q(a);a=a.replace(/\s+$/,"");return"<"+c+">"+a+"</"+c+">\n"}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,b,c,d){a=c;d=d.search(/[*+-]/g)>
-1?"ul":"ol";a=a.replace(/\n{2,}/g,"\n\n\n");a=q(a);return b+"<"+d+">\n"+a+"</"+d+">\n"}));return a=a.replace(/~0/,"")};q=function(a){d++;a=a.replace(/\n{2,}$/,"\n");a+="~0";a=a.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(a,b,c,d,e){a=e;b||a.search(/\n{2,}/)>-1?a=k(s(a)):(a=t(s(a)),a=a.replace(/\n$/,""),a=g(a));return"<li>"+a+"</li>\n"});a=a.replace(/~0/g,"");d--;return a};var A=function(a){a+="~0";a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,
function(a,b,c){a=u(s(b));a=v(a);a=a.replace(/^\n+/g,"");a=a.replace(/\n+$/g,"");return n("<pre><code>"+a+"\n</code></pre>")+c});return a=a.replace(/~0/,"")},n=function(a){a=a.replace(/(^\n+|\n+$)/g,"");return"\n\n~K"+(c.push(a)-1)+"K\n\n"},B=function(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d){a=d.replace(/^([ \t]*)/g,"");a=a.replace(/[ \t]*$/g,"");a=u(a);return b+"<code>"+a+"</code>"})},u=function(a){a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,
"&gt;");return a=o(a,"*_{}[]\\",!1)},D=function(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c;c=b.replace(/^[ \t]*>[ \t]?/gm,"~0");c=c.replace(/~0/g,"");c=c.replace(/^[ \t]+$/gm,"");c=k(c);c=c.replace(/(^|\n)/g,"$1  ");c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c;c=b.replace(/^  /mg,"~0");return c=c.replace(/~0/g,"")});return n("<blockquote>\n"+c+"\n</blockquote>")})},y=function(a){a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");return a=
a.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},E=function(a){a=a.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>');return a=a.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(a,b){return F(w(b))})},F=function(a){var b=[function(a){return"&#"+a.charCodeAt(0)+";"},function(a){a=a.charCodeAt(0);return"&#x"+("0123456789ABCDEF".charAt(a>>4)+"0123456789ABCDEF".charAt(a&15))+";"},function(a){return a}],a=("mailto:"+a).replace(/./g,function(a){if(a=="@")a=b[Math.floor(Math.random()*
2)](a);else if(a!=":")var c=Math.random(),a=c>0.9?b[2](a):c>0.45?b[1](a):b[0](a);return a});return a=('<a href="'+a+'">'+a+"</a>").replace(/">.+:/g,'">')},w=function(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)})},s=function(a){a=a.replace(/^(\t|[ ]{1,4})/gm,"~0");return a=a.replace(/~0/g,"")},v=function(a){a=a.replace(/\t(?=\t)/g,"    ");a=a.replace(/\t/g,"~A~B");a=a.replace(/~B(.+?)~A/g,function(a,b){for(var c=b,d=4-c.length%4,e=0;e<d;e++)c+=" ";
return c});a=a.replace(/~A/g,"    ");return a=a.replace(/~B/g,"")},o=function(a,b,c){b="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(b="\\\\"+b);return a=a.replace(RegExp(b,"g"),r)},r=function(a,b){return"~E"+b.charCodeAt(0)+"E"}}};var clientLib=require("com.pageforest.client"),dom=require("org.startpad.dom"),format=require("org.startpad.format"),markdown=new Showdown.converter;exports.extend({onReady:onReady,onReadyIndex:onReadyIndex,getDoc:getDoc,setDoc:setDoc,onSaveSuccess:onSaveSuccess,handleLocationHash:handleLocationHash,getDocid:getDocid,setDocid:setDocid});
var client,doc,blob,lastText="",syncTime=5,editVisible=!1,editorInitialized=!1,renderedText="",editTimer,EDIT_BUFFER=1E3,HEIGHT=700,H_TO_W_EDIT=0.77,H_TO_W_NOT_EDIT=0.5,index=!1;function getDocid(){return handleLocationHash().doc}function setDocid(b){handleLocationHash({doc:b})}
function handleLocationHash(b){var e=document.location.hash.replace(/#/,""),c,d;e.search("doc=")>-1&&(c=e.replace("doc=",""),c.search("&")>-1&&(c=c.split("&")[0]));e.search("page=")>-1&&(d=e.split("page="),d=d[d.length-1]);if(b){if(b.doc)c=b.doc;if(b.page)d=b.page;e="#";c&&(e+="doc="+c);d&&(c&&(e+="&"),e+="page="+d);location.replace(e)}return{doc:c,page:d}}
function onEditChange(){editTimer&&clearTimeout(editTimer);var b=doc.editor.value;b==renderedText?lastText=b:(client.setDirty(),lastText=b,editTimer=setTimeout(render,EDIT_BUFFER))}function render(){editTimer&&clearTimeout(editTimer);renderedText=lastText;doc.output.innerHTML=lastText;refresh();onResize()}
function toggleEditor(){(editVisible=!editVisible)?($(doc.page).addClass("edit"),editorInitialized||(editorInitialized=!0,$(doc.editor).bind("keyup",onEditChange).autoResize({limit:1E4}))):(render(),$(doc.page).removeClass("edit"));onResize();$(doc.edit).val(editVisible?"hide":"edit")}
function onReady(){handleAppCache();doc=dom.bindIDs();client=new clientLib.Client(exports);client.saveInterval=0;client.addAppBar();$(doc.edit).click(toggleEditor);$(window).bind("scroll",onScroll);setInterval(onEditChange,syncTime*1E3);$.ajax({url:"slides.html",error:function(){console.log("ajax load error")},success:function(b){doc.output.innerHTML=b;doc.editor.innerHTML=b;b=document.createElement("script");b.type="text/javascript";b.src="scripts/slides.js";b.onload=function(){handleDomLoaded()};
document.body.appendChild(b);onResize()}});$(window).bind("resize",onResize)}function onReadyIndex(){if(!document.location.hash)document.location="http://html5slides.pageforest.com/editor";index=!0;handleAppCache();doc=dom.bindIDs();client=new clientLib.Client(exports);client.saveInterval=0;$(document.body).addClass("index")}function onScroll(){doc.output.style["-webkit-transform"]=editVisible?"translate(0, "+window.scrollY+"px)":"translate(0, 0)"}
function onResize(){var b;editVisible?(b=parseFloat($("#outputBlock").css("width"))*H_TO_W_EDIT,$(doc.output).children().css("-webkit-transform","scale("+b/HEIGHT+")"),$(doc.output).css("height",b),$(doc.outputBlock).css("height",doc.editor.style.height)):(b=parseFloat($("#outputBlock").css("width"))*H_TO_W_NOT_EDIT,$(doc.output).children().css("-webkit-transform","scale("+b/HEIGHT+")"),$(doc.output).css("height",b),$(doc.outputBlock).css("height","100%"))}
function updateMeta(b){document.title=b.title;$("#title").text(b.title)}function onSaveSuccess(){updateMeta(client.meta)}function setDoc(b){index?(document.body.innerHTML=b.markdown,b=document.createElement("script"),b.type="text/javascript",b.src="scripts/slides.js",b.onload=function(){handleDomLoaded()},document.body.appendChild(b)):(doc.editor.value=b.blob.markdown,onEditChange(),updateMeta(b))}function getDoc(){if(!index)return{blob:{version:1,markdown:doc.editor.value},readers:["public"]}}
function handleAppCache(){typeof applicationCache!="undefined"&&(applicationCache.status==applicationCache.UPDATEREADY?(applicationCache.swapCache(),location.reload()):applicationCache.addEventListener("updateready",handleAppCache,!1))};